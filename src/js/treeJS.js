

var data2 = {
<<<<<<< HEAD
      "name": "한국표준산업분류",
      "shortName": "총 탄소 배출량 (단위 tCO2eq)",
      "children": [{
          "name": "A.농업, 임업 및 어업",
          "shortName": "A.농업, 임업 및 어업",
          "children": [{
              "name": "01.농업",
              "shortName": "01.농업",
              "children": [{
                  "name": "011.작물 재배업",
                  "shortName": "011.작물 재배업",
                  "size": 39
                },
                {
                  "name": "012.축산업",
                  "shortName": "012.축산업",
                  "size": 38
                },
                {
                  "name": "013.작물재배 및 축산 복합농업",
                  "shortName": "013.작물재배 및 축산 복합농업",
                  "size": 6714
                },
                {
                  "name": "014.작물재배 및 축산 관련 서비스업",
                  "shortName": "014.작물재배 및 축산 관련 서비스업",
                  "size": 743
                }
              ]
            },
            {
              "name": "02.임업",
              "shortName": "02.임업",
              "children": [{
                  "name": "020.임업",
                  "shortName": "020.임업",
                  "size": 3534
                }
              ]
            },
            {
              "name": "03.어업",
              "shortName": "03.어업",
              "children": [{
                "name": "031.어로 어업",
                "shortName": "031.어로 어업",
                "size": 7074
              },
              {
                "name": "032.양식어업 및 어업관련 서비스업",
                "shortName": "032.양식어업 및 어업관련 서비스업",
                "size": 707
              }
            ]
=======
  "name": "한국표준산업분류",
  "shortName": "총 탄소 배출량 (단위 tCO2eq)",
  "children": [{
      "name": "A.농업, 임업 및 어업",
      "shortName": "A.농업, 임업 및 어업",
      "children": [{
          "name": "01.농업",
          "shortName": "01.농업",
          "children": [{
              "name": "011.작물 재배업",
              "shortName": "011.작물 재배업",
              "size": 39
            },
            {
              "name": "012.축산업",
              "shortName": "012.축산업",
              "size": 380.08
            },
            {
              "name": "013.작물재배 및 축산 복합농업",
              "shortName": "013.작물재배 및 축산 복합농업",
              "size": 674.2
            },
            {
              "name": "014.작물재배 및 축산 관련 서비스업",
              "shortName": "014.작물재배 및 축산 관련 서비스업",
              "size": 703.2
>>>>>>> master
            }
          ]
        },
        {
<<<<<<< HEAD
          "name": "B.광 업",
          "shortName": "B.광 업",
          "children": [{
              "name": "05.석탄, 원유 및 천연가스 광업",
              "shortName": "05.석탄, 원유 및 천연가스 광업",
              "children": [{
                  "name": "051.석탄 광업",
                  "shortName": "051.석탄 광업",
                  "size": 300
                },
                {
                  "name": "052.원유 및 천연가스 채굴업",
                  "shortName": "2979",
                  "size": 3812
                },
              ]
            },
            {
              "name": "06.금속 광업",
              "shortName": "06.금속 광업",
              "children": [{
                  "name": "061.철 광업",
                  "shortName": "061.비철금속 광업",
                  "size": 3534
                }
              ]
            },
            {
              "name": "07.비금철금속 광업; 연료용 제외",
              "shortName": "07.비금철금속 광업; 연료용 제외",
              "children": [{
                "name": "071.토사석 광업",
                "shortName": "071.토사석 광업",
                "size": 7074
              },
              {
                "name": "072.기타 비금속광물 광업",
                "shortName": "072.기타 비금속광물 광업",
                "size": 7074
              }
            ]
            },
            {
              "name": "08.광업 지원 서비스업",
              "shortName": "08.광업 지원 서비스업",
              "children": [{
                "name": "080.광업 지원 서비스업",
                "shortName": "080.광업 지원 서비스업",
                "size": 123
              }
            ]
=======
          "name": "02.임업",
          "shortName": "02.임업",
          "children": [{
              "name": "020.임업",
              "shortName": "020.임업",
              "size": 3534.4
            }
          ]
        },
        {
          "name": "03.어업",
          "shortName": "03.어업",
          "children": [{
            "name": "031.어로 어업",
            "shortName": "031.어로 어업",
            "size": 7421.1
          },
          {
            "name": "032.양식어업 및 어업관련 서비스업",
            "shortName": "032.양식어업 및 어업관련 서비스업",
            "size": 707
          }
        ]
        }
      ]
    },
    {
      "name": "B.광 업",
      "shortName": "B.광 업",
      "children": [{
          "name": "05.석탄, 원유 및 천연가스 광업",
          "shortName": "05.석탄, 원유 및 천연가스 광업",
          "children": [{
              "name": "051.석탄 광업",
              "shortName": "051.석탄 광업",
              "size": 300
            },
            {
              "name": "052.원유 및 천연가스 채굴업",
              "shortName": "2979",
              "size": 312
            },
          ]
        },
        {
          "name": "06.금속 광업",
          "shortName": "06.금속 광업",
          "children": [{
              "name": "061.철 광업",
              "shortName": "061.비철금속 광업",
              "size": 334
>>>>>>> master
            }
          ]
        },
        {
<<<<<<< HEAD
          "name": "C.제 조 업",
          "shortName": "C.제 조 업",
          "children": [{
              "name": "10.식료품 제조업",
              "shortName": "10.식료품 제조업",
              "children": [{
                  "name": "101.도축, 육류 가공 및 저장 처리업",
                  "shortName": "101.도축, 육류 가공 및 저장 처리업",
                  "size": 100
                },
                {
                  "name": "102.수산물 가공 및 저장 처리업",
                  "shortName": "102.수산물 가공 및 저장 처리업",
                  "size": 38
                },
                {
                  "name": "103.과실, 채소 가공 및 저장 처리업",
                  "shortName": "103.과실, 채소 가공 및 저장 처리업",
                  "size": 38
                },
                {
                  "name": "104.동물성 및 식물성 유지 제조업",
                  "shortName": "104.동물성 및 식물성 유지 제조업",
                  "size": 381
                },
                {
                  "name": "104.낙농제품 및 식용 빙과류 제조업",
                  "shortName": "104.낙농제품 및 식용 빙과류 제조업",
                  "size": 3812
                },
                {
                  "name": "106.곡물 가공품, 전분 및 전분제품 제조업",
                  "shortName": "106.곡물 가공품, 전분 및 전분제품 제조업",
                  "size": 3812
                },
                {
                  "name": "107.기타 식품 제조업",
                  "shortName": "107.기타 식품 제조업",
                  "size": 3812
                },
                {
                  "name": "108.동물용 사료 및 조제식품 제조업",
                  "shortName": "108.동물용 사료 및 조제식품 제조업",
                  "size": 3812
                },
              ]
            },
            {
              "name": "11.음료 제조업",
              "shortName": "11.음료 제조업",
              "children": [{
                  "name": "",
                  "shortName": "",
                  "size": 3534
                }
              ]
            },
            {
              "name": "12.담배 제조업",
              "shortName": "12.담배 제조업",
              "children": [{
                  "name": "",
                  "shortName": "",
                  "size": 3534
                }
              ]
            },
            {
              "name": "13.섬유제품 제조업;의복 제외",
              "shortName": "13.섬유제품 제조업;의복 제외",
              "children": [{
                  "name": "",
                  "shortName": "",
                  "size": 35
                }
              ]
            },
            {
              "name": "14.의복, 의복 액세서리 및 모피제품 제조업",
              "shortName": "14.의복, 의복 액세서리 및 모피제품 제조업",
              "children": [{
                  "name": "",
                  "shortName": "",
                  "size": 35
                }
              ]
            },
            {
              "name": "15.가죽, 가방 및 신발 제조업",
              "shortName": "15.가죽, 가방 및 신발 제조업",
              "children": [{
                  "name": "",
                  "shortName": "",
                  "size": 1120
                }
              ]
            },
            {"name": "16",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "17",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "18",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "19",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "20",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "21",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "22",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "23",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "24",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "25",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "26",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "27",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "28",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "29",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "30",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "31",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "32",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "33",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
            {"name": "34",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]}        ]
        },
        {
          "name": "D.전기, 가스 증기 및 공기 조절 공급업",
          "shortName": "D.전기, 가스 증기 및 공기 조절 공급업",
          "children": [{
              "name": "35.전기, 가스 증기 및 공기 조절 공급업",
              "shortName": "35.전기, 가스 증기 및 공기 조절 공급업",
              "children": [{
                  "name": "352.연료용 가스 제조 및 배관공급업",
                  "shortName": "352.연료용 가스 제조 및 배관공급업",
                  "size": 2313
                },
                { "name": "","shortName": "","size": 10  },
                { "name": "","shortName": "","size": 10  }
              ] 
            }
          ]        
        }
      ]
}

var margin = {top: 30, right: 0, bottom: 0, left: 0},
width = 1200, //640
height = 530,
=======
          "name": "07.비금철금속 광업; 연료용 제외",
          "shortName": "07.비금철금속 광업; 연료용 제외",
          "children": [{
            "name": "071.토사석 광업",
            "shortName": "071.토사석 광업",
            "size": 7074
          },
          {
            "name": "072.기타 비금속광물 광업",
            "shortName": "072.기타 비금속광물 광업",
            "size": 704
          }
        ]
        },
        {
          "name": "08.광업 지원 서비스업",
          "shortName": "08.광업 지원 서비스업",
          "children": [{
            "name": "080.광업 지원 서비스업",
            "shortName": "080.광업 지원 서비스업",
            "size": 123
          }
        ]
        }
      ]
    },
    {
      "name": "C.제 조 업",
      "shortName": "C.제 조 업",
      "children": [{
          "name": "10.식료품 제조업",
          "shortName": "10.식료품 제조업",
          "children": [{
              "name": "101.도축, 육류 가공 및 저장 처리업",
              "shortName": "101.도축, 육류 가공 및 저장 처리업",
              "size": 100
            },
            {
              "name": "102.수산물 가공 및 저장 처리업",
              "shortName": "102.수산물 가공 및 저장 처리업",
              "size": 38
            },
            {
              "name": "103.과실, 채소 가공 및 저장 처리업",
              "shortName": "103.과실, 채소 가공 및 저장 처리업",
              "size": 38
            },
            {
              "name": "104.동물성 및 식물성 유지 제조업",
              "shortName": "104.동물성 및 식물성 유지 제조업",
              "size": 31
            },
            {
              "name": "104.낙농제품 및 식용 빙과류 제조업",
              "shortName": "104.낙농제품 및 식용 빙과류 제조업",
              "size": 32
            },
            {
              "name": "106.곡물 가공품, 전분 및 전분제품 제조업",
              "shortName": "106.곡물 가공품, 전분 및 전분제품 제조업",
              "size": 382
            },
            {
              "name": "107.기타 식품 제조업",
              "shortName": "107.기타 식품 제조업",
              "size": 382
            },
            {
              "name": "108.동물용 사료 및 조제식품 제조업",
              "shortName": "108.동물용 사료 및 조제식품 제조업",
              "size": 312
            },
          ]
        },
        {
          "name": "11.음료 제조업",
          "shortName": "11.음료 제조업",
          "children": [{
              "name": "",
              "shortName": "",
              "size": 354
            }
          ]
        },
        {
          "name": "12.담배 제조업",
          "shortName": "12.담배 제조업",
          "children": [{
              "name": "",
              "shortName": "",
              "size": 3534
            }
          ]
        },
        {
          "name": "13.섬유제품 제조업;의복 제외",
          "shortName": "13.섬유제품 제조업;의복 제외",
          "children": [{
              "name": "",
              "shortName": "",
              "size": 35
            }
          ]
        },
        {
          "name": "14.의복, 의복 액세서리 및 모피제품 제조업",
          "shortName": "14.의복, 의복 액세서리 및 모피제품 제조업",
          "children": [{
              "name": "",
              "shortName": "",
              "size": 35
            }
          ]
        },
        {
          "name": "15.가죽, 가방 및 신발 제조업",
          "shortName": "15.가죽, 가방 및 신발 제조업",
          "children": [{
              "name": "",
              "shortName": "",
              "size": 1120
            }
          ]
        },
        {"name": "16",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "17",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "18",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "19",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "20",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "21",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "22",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "23",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "24",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "25",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "26",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "27",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "28",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "29",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "30",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "31",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "32",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "33",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]},
        {"name": "34",  "shortName": "15","children": [{ "name": "","shortName": "","size": 10  }]}        ]
    },
    {
      "name": "D.전기, 가스 증기 및 공기 조절 공급업",
      "shortName": "D.전기, 가스 증기 및 공기 조절 공급업",
      "children": [{
          "name": "35.전기, 가스 증기 및 공기 조절 공급업",
          "shortName": "35.전기, 가스 증기 및 공기 조절 공급업",
          "children": [{
              "name": "352.연료용 가스 제조 및 배관공급업",
              "shortName": "352.연료용 가스 제조 및 배관공급업",
              "size": 2313
            },
            { "name": "","shortName": "","size": 10  },
            { "name": "","shortName": "","size": 10  }
          ] 
        }
      ]        
    },
    {
      "name": "E.수도, 하수 및 폐기물 처리, 원료 재생업",
      "shortName": "E.수도, 하수 및 폐기물 처리, 원료 재생업",
      "children": [{
          "name": "36.수도업",
          "shortName": "36.수도업",
          "children": [{
              "name": "360.수도업",
              "shortName": "360.수도업",
              "size": 2313
            },
            { "name": "","shortName": "","size": 10  },
            { "name": "","shortName": "","size": 10  }
          ] 
        },
        {
          "name": "37.하수,폐수 및 분뇨 처리업",
          "shortName": "37.하수,폐수 및 분뇨 처리업",
          "children": [{
              "name": "370.하수,폐수 및 분뇨 처리업",
              "shortName": "370.하수,폐수 및 분뇨 처리업",
              "size": 2313
            },
            { "name": "","shortName": "","size": 10  },
            { "name": "","shortName": "","size": 10  }
          ] 
        },
        {
          "name": "38.폐기물 수집,운반,처리 및 원료 재생업",
          "shortName": "38.폐기물 수집,운반,처리 및 원료 재생업",
          "children": [{
              "name": "381.폐기물 수집, 운반업",
              "shortName": "381.폐기물 수집,운반업",
              "size": 2313
            },
            { "name": "","shortName": "","size": 10  },
            { "name": "","shortName": "","size": 10  }
          ] 
        }
      ]        
    }
  ]
}

var margin = {top: 30, right: 0, bottom: 0, left: 10},
width = 1400, //640
height = 700,
>>>>>>> master
formatNumber = d3.format(",d"),
transitioning;

var x = d3.scaleLinear()
.domain([0, width])
.range([0, width]);

var y = d3.scaleLinear()
.domain([0, height - margin.top - margin.bottom])
.range([0, height - margin.top - margin.bottom]);

var color = d3.scaleOrdinal()
.range(d3.schemeCategory10
.map(function(c) { c = d3.rgb(c); c.opacity = 0.6; return c; }));
//var color = d3.scaleOrdinal(d3.schemeCategory20.map(fader));

var fader = function(color) { return d3.interpolateRgb(color, "#fff")(0.2); };
var format = d3.format(",d");
var treemap;
var svg, grandparent;

updateDrillDown();

function updateDrillDown() {
<<<<<<< HEAD
	if (svg) {
		svg.selectAll("*").remove();
	} else {
=======
if (svg) {
svg.selectAll("*").remove();
} else {
>>>>>>> master
//		 var treemap = d3.layout.treemap()
//	      .children(function(d, depth) { return depth ? null : d._children; })
//	      .sort(function(a, b) { return a.value - b.value; })
//	      .ratio(height / width * 0.5 * (1 + Math.sqrt(5)))
//	      .round(false);
<<<<<<< HEAD
	  
	  svg = d3.select("#domainDrillDown").append("svg")
      .attr("width", width - margin.left - margin.right)
      .attr("height", height - margin.bottom - margin.top)
      .style("margin-left", -margin.left + "px")
      .style("margin.right", -margin.right + "px")
	    .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
      .style("shape-rendering", "crispEdges");		
		
	  grandparent = svg.append("g")
      .attr("class", "grandparent");
		  
	  grandparent.append("rect")
      .attr("y", -margin.top)
      .attr("width", width)
      .attr("height", margin.top);
		  
	  grandparent.append("text")
      .attr("x", 6)
      .attr("y", 6 - margin.top)
      .attr("dy", ".75em")
      .attr("font-size", '25px');
      
      
		 
	 treemap = d3.treemap()
    .tile(d3.treemapResquarify.ratio(height / width * 0.5 * (1 + Math.sqrt(5))))
    .size([width, height])
    .round(false)
    .paddingInner(1);
	}
				  
  var root = d3.hierarchy(data2)
     .eachBefore(function(d) { d.id = (d.parent ? d.parent.id + "." : "") + d.data.shortName; })
     .sum((d) => d.size)
     .sort(function(a, b) {
     return b.height - a.height || b.value - a.value;
    });
		  
  initialize(root);
  accumulate(root);
  layout(root);
  treemap(root);
  display(root);
};

function initialize(root) {
  root.x = root.y = 0;
  root.x1 = width;
  root.y1 = height;
  root.depth = 0;
 }
=======

svg = d3.select("#domainDrillDown").append("svg")
  .attr("width", width - margin.left - margin.right)
  .attr("height", height - margin.bottom - margin.top)
  .style("margin-left", -margin.left + "px")
  .style("margin.right", -margin.right + "px")
  .append("g")
  .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
  .style("shape-rendering", "crispEdges");		

grandparent = svg.append("g")
  .attr("class", "grandparent");
  
grandparent.append("rect")
  .attr("y", -margin.top)
  .attr("width", width)
  .attr("height", margin.top);
  
grandparent.append("text")
  .attr("x", 6)
  .attr("y", 6 - margin.top)
  .attr("dy", ".75em")
  .attr("font-size", '25px');
  
  
 
treemap = d3.treemap()
.tile(d3.treemapResquarify.ratio(height / width * 0.5 * (1 + Math.sqrt(5))))
.size([width, height])
.round(false)
.paddingInner(1);
}
      
var root = d3.hierarchy(data2)
 .eachBefore(function(d) { d.id = (d.parent ? d.parent.id + "." : "") + d.data.shortName; })
 .sum((d) => d.size)
 .sort(function(a, b) {
 return b.height - a.height || b.value - a.value;
});
  
initialize(root);
accumulate(root);
layout(root);
treemap(root);
display(root);
};

function initialize(root) {
root.x = root.y = 0;
root.x1 = width;
root.y1 = height;
root.depth = 0;
}
>>>>>>> master

// Aggregate the values for internal nodes. This is normally done by the
// treemap layout, but not here because of our custom implementation.
// We also take a snapshot of the original children (_children) to avoid
// the children being overwritten when when layout is computed.
function accumulate(d) {
<<<<<<< HEAD
  return (d._children = d.children)
     ? d.value = d.children.reduce(function(p, v) { return p + accumulate(v); }, 0) : d.value;
  }
=======
return (d._children = d.children)
 ? d.value = d.children.reduce(function(p, v) { return p + accumulate(v); }, 0) : d.value;
}
>>>>>>> master

// Compute the treemap layout recursively such that each group of siblings
// uses the same size (1×1) rather than the dimensions of the parent cell.
// This optimizes the layout for the current zoom state. Note that a wrapper
// object is created for the parent node for each group of siblings so that
// the parent’s dimensions are not discarded as we recurse. Since each group
// of sibling was laid out in 1×1, we must rescale to fit using absolute
// coordinates. This lets us use a viewport to zoom.
function layout(d) {
<<<<<<< HEAD
  if (d._children) {
//    treemap.nodes({_children: d._children});
//	  treemap(d);
    d._children.forEach(function(c) {
      //c.x0 = d.x0 + c.x0 * (d.x1 - d.x0);
      //c.y0 = d.y0 + c.y0 * (d.y1 - d.y0);
      //c.x1 *= d.x1;
      //c.y1 *= d.y1;    
      c.x0 = d.x0 + c.x0 * d.x1;
      c.y0 = d.y0 + c.y0 * d.y1;
      c.x1 *= (d.x1 - d.x0);
      c.y1 *= (d.y1 - d.y0);
      c.parent = d;
      layout(c);
    });
  }
}

function display(d) {
  grandparent
    .datum(d.parent)
    .on("click", transition)
    .select("text")
    .text(name(d));

  var g1 = svg.insert("g", ".grandparent")
    .datum(d)
    .attr("class", "depth");
  
  var g = g1.selectAll("g")
    .data(d._children)
    .enter().append("g");
 
  g.filter(function(d) { return d._children; })
    .classed("children", true)
    .on("click", transition);

  
  var children = g.selectAll(".child")
    .data(function(d) { return d._children || [d]; })
    .enter().append("g");
  
  children.append("rect")
    .attr("class", "child")
    .call(rect)
    .append("title")
    .text(function(d) { return d.data.shortName + " (" + formatNumber(d.value) + ")"; });

  children.append("text")
    .attr("class", "ctext")
    .text(function(d) { return d.data.shortName; })
    .call(text2);
  
  g.append("rect")
    .attr("class", "parent")
    .call(rect);
  
	var t = g.append("text")
	  .attr("class", "ptext")
	  .attr("dy", ".75em")
	
	t.append("tspan")
    .attr("dy", "1.5em")
    .attr("font-size", "30px")
	  .text(function(d) { return d.data.shortName; });

  t.append("tspan")
	  .attr("dy", "1.5em")
    .attr("font-size", "25px")
	  .text(function(d) { return formatNumber(d.value); });
  
	t.call(text);
	
	g.selectAll("rect")
	  .style("fill", function(d) { return color(d.data.shortName); });
	
	function transition(d) {
    if (transitioning || !d) return;
    transitioning = true;
    var g2 = display(d),
      t1 = g1.transition().duration(750),
      t2 = g2.transition().duration(750);
      
      // Update the domain only after entering new elements.
      //x.domain([d.x0, d.x0 + d.x1]);
      //y.domain([d.y0, d.y0 + d.y1]);
      x.domain([d.x0, d.x0 + (d.x1 - d.x0)]);
      y.domain([d.y0, d.y0 + (d.y1 - d.y0)]);

      // Enable anti-aliasing during the transition.
      svg.style("shape-rendering", null);

      // Draw child nodes on top of parent nodes.
      svg.selectAll(".depth").sort(function(a, b) { 
      	return a.depth - b.depth; });

      // Fade-in entering text.
      g2.selectAll("text").style("fill-opacity", 0);

      // Transition to the new view.
      t1.selectAll(".ptext").call(text).style("fill-opacity", 0);
      t2.selectAll(".ptext").call(text).style("fill-opacity", 1);
      t1.selectAll(".ctext").call(text2).style("fill-opacity", 0);
      t2.selectAll(".ctext").call(text2).style("fill-opacity", 1);
      t1.selectAll("rect").call(rect);
      t2.selectAll("rect").call(rect);

      // Remove the old node when the transition is finished.
      t1.remove().on("end", function() {
      svg.style("shape-rendering", "crispEdges");
      transitioning = false;
      
      change_List(d);
       change_Arrow(d.data.name);
    });
  }
  return g;
}

function text(text) {
  text.selectAll("tspan")
    .attr("x", function(d) { return x(d.x0) + 6; })
  text.attr("x", function(d) { return x(d.x0) + 6; })
    .attr("y", function(d) { return y(d.y0) + 3; })
    .style("opacity", function(d) {
       var w = x(d.x1) - x(d.x0);
       return this.getComputedTextLength() < w - 6 ? 1 : 0; });
  }

function text2(text) {
  text.attr("x", function(d) {
     return x(d.x1) - this.getComputedTextLength() - 6;
  })
  .attr("y", function(d) { return y(d.y1) - 6; })
  .style("opacity", function(d) {
     var w = x(d.x1) - x(d.x0);
     return this.getComputedTextLength() < w - 6 ? 1 : 0;
  });
}

function rect(rect) {
  rect.attr("x", function(d) { return x(d.x0); })
    .attr("y", function(d) { return y(d.y0); })
    .attr("width", function(d) {
      var w = x(d.x1) - x(d.x0);
 	    return w;
	})
    .attr("height", function(d) { 
      var h = y(d.y1) - y(d.y0);
 	    return h;
 	});
}

function name(d) {
  return d.parent ? name(d.parent) + " / " + d.data.shortName + " (" + formatNumber(d.value) + ")" : d.data.shortName + " (" + formatNumber(d.value) + ")";
=======
if (d._children) {
//    treemap.nodes({_children: d._children});
//	  treemap(d);
d._children.forEach(function(c) {
  //c.x0 = d.x0 + c.x0 * (d.x1 - d.x0);
  //c.y0 = d.y0 + c.y0 * (d.y1 - d.y0);
  //c.x1 *= d.x1;
  //c.y1 *= d.y1;    
  c.x0 = d.x0 + c.x0 * d.x1;
  c.y0 = d.y0 + c.y0 * d.y1;
  c.x1 *= (d.x1 - d.x0);
  c.y1 *= (d.y1 - d.y0);
  c.parent = d;
  layout(c);
});
}
}

function display(d) {
grandparent
.datum(d.parent)
.on("click", transition)
.select("text")
.text(name(d));

var g1 = svg.insert("g", ".grandparent")
.datum(d)
.attr("class", "depth");

var g = g1.selectAll("g")
.data(d._children)
.enter().append("g");

g.filter(function(d) { return d._children; })
.classed("children", true)
.on("click", transition);


var children = g.selectAll(".child")
.data(function(d) { return d._children || [d]; })
.enter().append("g");

children.append("rect")
.attr("class", "child")
.call(rect)
.append("title")
.text(function(d) { return d.data.shortName + " (" + formatNumber(d.value) + ")"; });

children.append("text")
.attr("class", "ctext")
.text(function(d) { return d.data.shortName; })
.call(text2);

g.append("rect")
.attr("class", "parent")
.call(rect);

var t = g.append("text")
.attr("class", "ptext")
.attr("dy", ".75em")

t.append("tspan")
.attr("dy", "1.5em")
.attr("font-size", "30px")
.text(function(d) { return d.data.shortName; });

t.append("tspan")
.attr("dy", "1.5em")
.attr("font-size", "25px")
.text(function(d) { return formatNumber(d.value); });

t.call(text);

g.selectAll("rect")
.style("fill", function(d) { return color(d.data.shortName); });

function transition(d) {
if (transitioning || !d) return;
transitioning = true;
var g2 = display(d),
  t1 = g1.transition().duration(750),
  t2 = g2.transition().duration(750);
  
  // Update the domain only after entering new elements.
  //x.domain([d.x0, d.x0 + d.x1]);
  //y.domain([d.y0, d.y0 + d.y1]);
  x.domain([d.x0, d.x0 + (d.x1 - d.x0)]);
  y.domain([d.y0, d.y0 + (d.y1 - d.y0)]);

  // Enable anti-aliasing during the transition.
  svg.style("shape-rendering", null);

  // Draw child nodes on top of parent nodes.
  svg.selectAll(".depth").sort(function(a, b) { 
    return a.depth - b.depth; });

  // Fade-in entering text.
  g2.selectAll("text").style("fill-opacity", 0);

  // Transition to the new view.
  t1.selectAll(".ptext").call(text).style("fill-opacity", 0);
  t2.selectAll(".ptext").call(text).style("fill-opacity", 1);
  t1.selectAll(".ctext").call(text2).style("fill-opacity", 0);
  t2.selectAll(".ctext").call(text2).style("fill-opacity", 1);
  t1.selectAll("rect").call(rect);
  t2.selectAll("rect").call(rect);

  // Remove the old node when the transition is finished.
  t1.remove().on("end", function() {
  svg.style("shape-rendering", "crispEdges");
  transitioning = false;
  
  change_List(d);
   change_Arrow(d.data.name);
});
}
return g;
}

function text(text) {
text.selectAll("tspan")
.attr("x", function(d) { return x(d.x0) + 23; })
text.attr("x", function(d) { return x(d.x0) + 6; })
.attr("y", function(d) { return y(d.y0) + 10; })
.style("opacity", function(d) {
   var w = x(d.x1) - x(d.x0);
   return this.getComputedTextLength() < w - 6 ? 1 : 0; });
}

function text2(text) {
text.attr("x", function(d) {
 return x(d.x1) - this.getComputedTextLength() - 6;
})
.attr("y", function(d) { return y(d.y1) - 6; })
.style("opacity", function(d) {
 var w = x(d.x1) - x(d.x0);
 return this.getComputedTextLength() < w - 6 ? 1 : 0;
});
}

function rect(rect) {
rect.attr("x", function(d) { return x(d.x0); })
.attr("y", function(d) { return y(d.y0); })
.attr("width", function(d) {
  var w = x(d.x1) - x(d.x0);
   return w;
})
.attr("height", function(d) { 
  var h = y(d.y1) - y(d.y0);
   return h;
});
}

function name(d) {
return d.parent ? name(d.parent) + " / " + d.data.shortName + " (" + formatNumber(d.value) + ")" : d.data.shortName + " (" + formatNumber(d.value) + ")";
>>>>>>> master
}


function show_Detail_Industry(div){
<<<<<<< HEAD
  let ul_nodes = div.parentNode.childNodes[3];
  $(ul_nodes).find('div').show();
  
}
// 대분류 카테고리 닫기
function hide_Detail_Industry(div){
  let ul_nodes = div.parentNode.childNodes[3];
  $(ul_nodes).find('div').hide();
}

function show_Small_Detail_Industry(div){
  let li_nodes = div.parentNode.childNodes[3];
  $(li_nodes).find('li').show();
}
//소분류 카테고리 닫기
function hide_Small_Detail_Industry(div){
  let li_nodes = div.parentNode.childNodes[3];
  $(li_nodes).find('li').hide();
=======
let ul_nodes = div.parentNode.childNodes[3];
$(ul_nodes).find('div').show();

}
// 대분류 카테고리 닫기
function hide_Detail_Industry(div){
let ul_nodes = div.parentNode.childNodes[3];
$(ul_nodes).find('div').hide();
}

function show_Small_Detail_Industry(div){
let li_nodes = div.parentNode.childNodes[3];
$(li_nodes).find('li').show();
}
//소분류 카테고리 닫기
function hide_Small_Detail_Industry(div){
let li_nodes = div.parentNode.childNodes[3];
$(li_nodes).find('li').hide();
>>>>>>> master

}

function change_Arrow(select_div_data){

<<<<<<< HEAD
  let select_code = select_div_data.substring(0,1);
  if(select_code == 'A'){
    let zoom_div = document.getElementById( select_code+'_industry');
    let clickI = zoom_div.getElementsByTagName('i');
  
    const CURRENT_ARROW_DOWN = "fas fa-chevron-down";
    const CURRENT_ARROW_RIGHT ="fas fa-chevron-right";
  
    if (clickI[0].className == CURRENT_ARROW_RIGHT ) {
      clickI[0].className = CURRENT_ARROW_DOWN;
    }
    else {
        clickI[0].className = CURRENT_ARROW_RIGHT;
    } 
  }
=======
let select_code = select_div_data.substring(0,1);
if(select_code == 'A'){
let zoom_div = document.getElementById( select_code+'_industry');
let clickI = zoom_div.getElementsByTagName('i');

const CURRENT_ARROW_DOWN = "fas fa-chevron-down";
const CURRENT_ARROW_RIGHT ="fas fa-chevron-right";

if (clickI[0].className == CURRENT_ARROW_RIGHT ) {
  clickI[0].className = CURRENT_ARROW_DOWN;
}
else {
    clickI[0].className = CURRENT_ARROW_RIGHT;
} 
}
>>>>>>> master
}


//A선택

function change_List(d){

<<<<<<< HEAD
  let select_code;
  let zoom_div;



  if(d.depth==1 ){
    select_code = d.data.name.substring(0,1);
    zoom_div = document.getElementById( select_code+'_industry');
    show_Detail_Industry(zoom_div);
  }
  else if (d.depth==2 ){
    select_code = d.data.name.substring(0,2);
    zoom_div = document.getElementById(select_code +'_industry_sector' );
   
    //show_Small_Detail_Industry(zoom_div);
    $(zoom_div).find('li').show();

  }

}

=======
let select_code;
let zoom_div;



if(d.depth==1 ){
select_code = d.data.name.substring(0,1);
zoom_div = document.getElementById( select_code+'_industry');
show_Detail_Industry(zoom_div);
}
else if (d.depth==2 ){
select_code = d.data.name.substring(0,2);
zoom_div = document.getElementById(select_code +'_industry_sector' );

//show_Small_Detail_Industry(zoom_div);
$(zoom_div).find('li').show();

}

}


>>>>>>> master
